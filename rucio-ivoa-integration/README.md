# install

helm upgrade --install -n rucio-ivoa-integration dachs /opt/ska-rucio-ivoa-integration/dachs/etc/helm/ --values dachs-values.yaml

helm-srcnet-workload-1 upgrade --install -n rucio-ivoa-integration --set oidcAgentAuthClientCfgValue="ODI5XG5jdFhsUkthOGhVTHpUWTNDNElLUjVzL1VDKy9EZmt6WFxuZEtwbFJqWHRlZ2ZiSnE5THBzOHVuUT09XG4yNDoxNjoxNjozMjoxOjI6NjcxMDg4NjQ6MlxuVmtNU1QvWlE5R1NhUHhlWmFvbFNFV3NTb016SlJ1RFk4bTNLSHdzTXlHeTlveGV0OU42YUZNbkZ0c0ZzbGI5WjljUlJrWXZVTWQvSmlXSTZta29nSDZBNXM1VzZvOHV4bnJwNmVTWXJlckRWZlVsUStLUFVoOGlNUUVlTkhMMnBBOHZYUkgyM3RXMEhXRFB1S2hQSC9QV1p3WnhKeUlYajlyUEZ1QWlETk10RURNZFdIWmwwdWFZdVlaM3lwYXdHNHY2SU9ZSVloV3dabFQ0eHBxK0IwbXlnWjRyaHNCUW9PYW5ucW0xR0ZKS1BPaGpyWGhKMTY1a1dab2pjNmlpTktja2YyS1ovQkJCNkZiTG9QZXR2QkxjOVdENjB6VzkxS1ZXdDFDSEV0eUpVNHlscnVtN1dwYTBtVTFTOVZNSHpISEhtMHdCMXpJWmxzY1ZaRXBPNWFxdk5lSDN2WGNhblNFa09vTG9qRFliVXlMQ3BTQUNMVlIrWFNUUGRxVUl6aG5RTVdmV1FncU1wOGRrWkdYemJwb1p3eXB0M3o5NHM0UWZjODFZU25CaHNlS2xCa3JMVm40VjZXQTVwTThab0MxNHUxZVVpS0g4N1ljaER2MHV6WGZYa1pFQWZqZ3VWWGIyZ1VaQm5ZaFNONVdnMDU1eHBMWXdqTXNyMEt1OU50THRsMmszLzdjN0FuTlF6am9tSCsvUGZZdmZFdzNvWmU5b3NlTE9DMGVJcUhzbnV2Q3FTTFpQNWpqOUgxTkRIQXg1TXk1ZTRkL0YydjFWcEp5NVJwYVdnaWtSOU5WNHQvMmJVT3RjUGFLK05XYWZ3VFQra0RBenR3eWVyK2gyY254RTYwQysrc0pGRWt2c3JtZmVhcmlxSXNwUEF4S0pPYjhKeUNBMURuLzRZMVhMa2VTaUNPNDV0L1NMckVHOFYyUW9ueG9QTWRZN1Z3MTdmdlpPYllySU40NW1zVXA3UUorZm5iSjBzdkI5eDA1NEM5ZGpRRlB1R1ZRNjJNWUp1WjhMbHpzS2RQeGtYWW5nTE1DUDhrenBVTWV3V3FJa25UdzltbmJUQ2xMUThzbEJBVmt2T1BBQUREVGl5S0hEelFGRHFnM3FBMjhFTFNPNm1WL1AvdEpwTDVvUS9jV2diUUU4NE10bkpSQmFEakQvMXJtazhVYTZLaGpCMVEwS25UQitIc0dVTXhJamVLN3NyUE1UMGp0WmhiRmtCaHdJZGJvTXlMTXN3Z090bXBUOUFzcWtZNHU3VUNvMU85Y2lpWHk5YVdtcmc5Vlg5UTNONGtxc3hRaDF4bnloYWpDa2JyZCtBeWF1cmVGQit5cXlXb0c1T3VsclZPVnFva0QraFFWUnZIK3F0UnMwa3luYnZ3bmt4YUx6ZnR3Mm5FRjA1QXVKVGRBd3p3Rk5tUEpqWDhxVmdNdDRnbHo1NWpNME5mR2JTTDlvWUJYZFY5TjlmMEE9PVxuZmpiRUJmZDNUK2cxTEhPMk1maStjc003QU5VbFh6bEFnNVJjOE1CVkpNOD1cbkdlbmVyYXRlZCB1c2luZyB2ZXJzaW9uOiA0LjIuNA==" --set oidcAgentAuthClientCfgPassword="dlpHZFFYVDJ6Q002ZkxqYw==" --set geoIpLicenseKey="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" --set siteCapabilitiesClientSecret="QUpnZFZySVF6UTgtS09WRUVMZm95Mjg1Z2ltT1FXUm9ZVVdvUmJDcU4wSWtTbHFDYkJGS0lJc0JKSWFSR05zcmRJdTVVNzR5ZUVpODBOY1RJcVBjVXVZ" rucio-datalink /opt/ska-rucio-ivoa-integration/rucio-datalink/etc/helm/ --values rucio-datalink-values.yaml

# notes

Sometimes the rewrite for the datalink service doesn't propagate, if getting a 404 check for: 

nginx.ingress.kubernetes.io/rewrite-target: /$2

in the annotations for the ingress

---

For the client's forwarded header to be passed through to the service:
- HAproxy needs option forwardfor set, and 
- use-forwarded-headers: "true" in nginx-ingress configmap data block

