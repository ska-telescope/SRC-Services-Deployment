apiVersion: v1
kind: Namespace
metadata:
  name: registry
  labels:
    name: registry

---
apiVersion: v1
data:
  registry-ca: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUdJakNDQkFxZ0F3SUJBZ0lVVDkzRE5YQUh0RzVudFZPd1REaFRnQmtTenhjd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2daY3hDekFKQmdOVkJBWVRBbFZMTVJBd0RnWURWUVFJREFkRmJtZHNZVzVrTVJNd0VRWURWUVFIREFwTgpZVzVqYUdWemRHVnlNUTB3Q3dZRFZRUUtEQVJUUzBGUE1STXdFUVlEVlFRTERBcFBjR1Z5WVhScGIyNXpNUnd3CkdnWURWUVFEREJNeE16QXVNalEyTGpJeE15NDRNRG8xTURBd01SOHdIUVlKS29aSWh2Y05BUWtCRmhCeUxtcHYKYzJocFFITnJZVzh1YVc1ME1CNFhEVEl6TURVeE5URTBORGN3TmxvWERUSTBNRFV4TkRFME5EY3dObG93Z1pjeApDekFKQmdOVkJBWVRBbFZMTVJBd0RnWURWUVFJREFkRmJtZHNZVzVrTVJNd0VRWURWUVFIREFwTllXNWphR1Z6CmRHVnlNUTB3Q3dZRFZRUUtEQVJUUzBGUE1STXdFUVlEVlFRTERBcFBjR1Z5WVhScGIyNXpNUnd3R2dZRFZRUUQKREJNeE16QXVNalEyTGpJeE15NDRNRG8xTURBd01SOHdIUVlKS29aSWh2Y05BUWtCRmhCeUxtcHZjMmhwUUhOcgpZVzh1YVc1ME1JSUNJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBZzhBTUlJQ0NnS0NBZ0VBeWdoUDN3NnR6SU1hCkp6N0hLcUtvd25QWlNyZ2svNzFyT2k3MmRTUWFYODFBU0NndkVzU3pmOGI4RjVYQlBhaEFDMDl2cS9QMlU3T0wKN0NaTTZNMlhtOCtiZEZIT0ZQQXVIdG92Z3o0cGJGcENZNldZamVOdWt6Q2NCcGV4UHFPM2U4R05WOGkzSGMrZwppTjFyNkN5ZEJkbFNLbGFMcU5CZkNRU3k2NXdBbGdPdHBtelcvWHRDSk5aNkNZaS85dldqNk4xK0gzcWRIajZGCjBTY3J1RjVtejFJdUlaWHFzNDY1c1hubFR0UmhiOEJOYXBtRlB3ME9xOHNiOCs0ZjlPV3Y0T2hUS25ab0ZLaWMKY1FEckJPY1BTdXN2VmFBWHk0YTZ1SGJiYk1PYk90RDZZcVREa1M4a09aWHo2WWNjWGJJUDhsL0s5TlVqV0ovbwpkVExydWtna005QldWdmREOTJPU2huV0pVOFdlK0hhQVE5cHlydDhiR2RoS2l5czBHN1RubVRFOFViNWluckRWCk1XVVhxUHc2SDd2K0JyRVdGeGdaY2s3YldSU2pVaThCRW0rM3RUeUxyYkhodGxXQjZmSDh5SEY5NGl0WFVWV2MKbjdhbEIrNU9YWFI1MmZnbUlSZVlBeXdXakluWVQ0TmppTG0rL2Q2NS9uYTEyUm5NaWJ3Tlo4b0c4RVZQTU1UdgpSVEVqWUJSYmp4aGVKUkRVdHZoWUtHV3A0R0d1QzV2NEQzZEdpdXNnaEFuNnJUSGMzTmdnZCt1VzhrUEVPMkoxCnlSNGJsbnlyWHgwdnFMZmM0akt2L3FjcWoyRmVnUnRnbkJVOFhyVXZYTEVwdDRENkJxMy9GbnhBekRJRWpFY1UKcGRWSnhvSGVwUFdBUnM1Sk1ITERNeDRLNzZpU04wa0NBd0VBQWFOa01HSXdEd1lEVlIwUkJBZ3dCb2NFZ3ZiVgpVREFkQmdOVkhRNEVGZ1FVaHhSMElDamI5UDlabXl5Z0YwUysxSzRaVlpJd0h3WURWUjBqQkJnd0ZvQVVoeFIwCklDamI5UDlabXl5Z0YwUysxSzRaVlpJd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBTkJna3Foa2lHOXcwQkFRc0YKQUFPQ0FnRUFCcEsvbzNCdHNxcDhaTlNuQ2tYWVpiYkZKRFkzZmNUbWJQMUhLRVN0T2sxSG1zQU1KZFdzdG1DbQpOWmxQSU5tNnNMc0VCQVk1VDdTbWpTcGF3SFR0dkd2anprMUNMY0E2VS9EUFFFMmVaL21UWlpmRWNzR0hmRkJZClBxUGQ3Z0drZGZRT3RBT0RBU1hIcU42elVHWStvRVc0dUVkR01GdjUvVzRuZFM4c0l5bU9LVmhKU2RhSCtJenYKR2NhdGtFUWFNY2I5d0t3S0dGYUtFRjdBRzk2SFJUNll0TzB4d3lza2lINEFINCtRUWdlSlB6WW9saTJyNTBJdgorL3REZEQ2VWZaenlBVG8wNUUwSldTMmZWdkg4TFJOcHBVYXZwdStTUitwRGhXNkJHWjQwS3BudERaQmVCcEt0ClFNOTgyV1J5UmhDdWxCZWJUbjlXZWZpT29XVHFMbTgvWG85M05Bc2M2T3B1eVZrcWFaYm51ZnB1cXQyR0xRbWMKQlBJYW0wSHBLNTZpYW5SYnlxUGhPUWIwejFyS2NGSXpzaG1McGd1eVk0UWJyMVNkcGtJQjZDMDZjNHM0OVh3LwpRbU5VWkVWVWdTREd1Y29qOHhhZE5nWFJVNnQvTmFjRnEvSnVLcGRKT0NSYlJVMklib1BNcTRpd1dKdDQ1dyt3CkNTaUQreUdkKzVkTEFvZnFUdWtUSUtxS1BGZXhZTy9RMUhGY01QYmQ4SWh0Zk5KZzhpc2R4Z3JvOHRTNm5UZG0KLytIYW1TblNBc2haS2RNWlE1UU4rS2RBQU9CQnY1ajB1aC9HSTNTRDhoRFRoS25sVGhROHExOTZxZlhJaTh0cwo5WTY4T1J3NWorRnpDckNoRkNRUW1lT2JmenB5R2FNcjJkQnk4bDBrRzQwbmxyQ1ZyU2s9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
kind: Secret
metadata:
  name: registry-ca
  namespace: registry
type: Opaque

---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: add-registry-ca
  namespace: registry
  labels:
    k8s-app: add-registry-ca
spec:
  selector:
    matchLabels:
      name: add-registry-ca
  template:
    metadata:
      labels:
        name: add-registry-ca
    spec:
      containers:
      - name: add-registry-ca
        image: busybox
        command: [ 'sh' ]
        args: [ '-c', 'mkdir -p /etc/docker/certs.d/130.246.213.80:5000 && cp /home/core/registry-ca /etc/docker/certs.d/130.246.213.80:5000/ca.crt && exec tail -f /dev/null' ]
        volumeMounts:
        - name: etc-docker
          mountPath: /etc/docker/certs.d
        - name: ca-cert
          mountPath: /home/core
      terminationGracePeriodSeconds: 30
      volumes:
      - name: etc-docker
        hostPath:
          path: /etc/docker/certs.d
      - name: ca-cert
        secret:
          secretName: registry-ca
